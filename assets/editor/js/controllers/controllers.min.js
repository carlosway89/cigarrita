var modal_options=function(b,d,c,a){b.save_external=function(f,e){e.stopImmediatePropagation();if(f.idblock){var g="block";}else{var g="post";}a.$broadcast("inline.saving."+g,f);
};d.get($base_url+"/api/template/modal/cms").then(function(f){var e=$("[ng-view]");e.append(f.data);});b.options={height:200,toolbar:[["color",["color"]],["insert",["link","picture"]],["table",["table"]],["font",["bold","italic","underline","clear"]],["fontsize",["fontsize"]],["height",["height"]],["para",["ul","ol","paragraph"]],["misc",["codeview"]]]};
b.$on("show.modal",function(f,g){b.posting={state:1,source:""};var e=$("#modal_post").find(".fileinput-new.thumbnail");e.find("#counter_loader").remove();
e.find("#alert_error_upload").remove();e.removeClass("ui btn loading");setTimeout(function(){b.posting=g;$("#modal_post").find("img").attr("src",g.source);
b.text_subheader=g.subheader;c(document.getElementById("modal_post"))(b);$("#modal_post").modal_cw("show");},100);});b.$on("close.modal",function(){$("#modal_post").modal_cw("hide");
});};cigarritaControllers.controller("indexCtrl",["$rootScope","$scope","$compile","$http","Model",function(i,j,d,g,c){var h={estado:1,is_deleted:0};c.query({model:"language",id:"query",query:JSON.stringify(h)},function(l){j.current=beans.readCookie("language.initial");
j.language=l;});var k=function(){var l={state:1,is_deleted:0,language:beans.readCookie("language.initial")};j.links=c.query({model:"menu",id:"query",query:JSON.stringify(l)});
};k();j.$on("language.changed",function(){k();});j.handle_saving=function(n){var l=$("#save_external");var m=$("#close_modal");if(n=="click"){m.attr("disabled","disabled").hide();
l.attr("disabled","disabled").addClass("ui loading");}else{if(n=="saved"){var o=l.html();l.removeClass("ui loading").addClass("ui success").html("&#x2713;");
setTimeout(function(){i.$broadcast("close.modal");l.html(o);m.removeAttr("disabled").show();l.removeAttr("disabled").removeClass("ui success");},1000);
}else{i.$broadcast("close.modal");m.removeAttr("disabled").show();l.removeAttr("disabled").removeClass("ui loading");}}};var b=j.$on("inline.saving.block",function(l,m){j.save_block(m);
j.handle_saving("click");});var f=j.$on("inline.saving.post",function(l,m){j.save_post(m);j.handle_saving("click");});j.$on("delete.item",function(m,n,l){console.log(n,l);
j.delete_post(n,l);});var a=0;var e=0;j.save_post=function(m){if(!m.idpost){var l=new c({model:"post"});l=$.extend(l,m);l.$save(function(n){for(var o=j.$$childTail.page.length-1;
o>=0;o--){if(j.$$childTail.page[o].category==n.category){j.$$childTail.page[o].posts.push(n);}}j.handle_saving("saved");a=0;},function(n){setTimeout(function(){a=a+1;
if(a>3){alert("Contection Error!!Reloading!!");setTimeout(function(){window.top.location.reload();},2000);}else{j.save_post(m);}},3000);});}else{var l=new c({model:"post",id:m.idpost});
l=$.extend(l,m);l.$update(function(){j.handle_saving("saved");a=0;},function(n){setTimeout(function(){a=a+1;if(a>3){alert("Contection Error!!Reloading!!");
setTimeout(function(){window.top.location.reload();},2000);}else{j.save_post(m);}},3000);});}};j.delete_post=function(n,m,o){var l=new c({model:"post",query:n.idpost,id:"safe"});
console.log(j,o);};j.save_block=function(m){if(!m.idblock){var l=new c({model:"block"});l=$.extend(l,m);l.$save(function(n){j.handle_saving("saved");e=0;
},function(n){setTimeout(function(){e=e+1;if(e>3){alert("Contection Error!!Reloading!!");setTimeout(function(){window.top.location.reload();},2000);}else{j.save_block(m);
}},3000);});}else{var l=new c({model:"block",id:m.idblock});l=$.extend(l,m);l.$update(function(){j.handle_saving("saved");e=0;},function(n){setTimeout(function(){e=e+1;
if(e>3){alert("Contection Error!!Reloading!!");setTimeout(function(){window.top.location.reload();},2000);}else{j.save_block(m);}},3000);});}};j.check_status=function(){$.addBeat("transmition-check",function(){$.ajax({type:"GET",url:$base_url+"/api/checkStatus",success:function(l){if(l.status=="logout"){window.top.location.reload();
}}});},60000);};j.check_status();$(".selection.dropdown").dropdown();}]);cigarritaControllers.controller("homeCtrl",["$scope","Content","$route","$rootScope","$compile","$http","Model",function(i,c,g,h,d,f,b){var a=g.current.$$route.pageid;
var e=function(){var j={language:beans.readCookie("language.initial"),state:1,idpage:a,is_deleted:0};i.page=c.query({query:JSON.stringify(j)},function(k){setTimeout(function(){var l=document.createElement("script");
l.type="text/javascript";l.src="/themes/design/js/script.js";document.body.appendChild(l);$(".loading-container").hide();$(".preloader").hide();},1000);
});};e();i.$on("language.changed",function(){e();});modal_options(i,f,d,h);}]);cigarritaControllers.controller("pageCtrl",["$scope","Content","Language","$route","$http","$compile","$rootScope",function(i,c,b,g,f,d,h){var a=g.current.$$route.pageid;
var e=function(){var j={language:beans.readCookie("language.initial"),state:1,idpage:a,is_deleted:0};i.page=c.query({query:JSON.stringify(j)},function(k){var l=document.createElement("script");
l.type="text/javascript";l.src="/themes/design/js/script.js";document.body.appendChild(l);$(".loading-container").hide();$(".preloader").hide();});};e();
i.$on("language.changed",function(){e();});modal_options(i,f,d,h);}]);cigarritaControllers.controller("contentCtrl",["$scope","Model","Post","Menu","Block","Sort","Language","RunFile","Template","MultiLanguage",function(k,e,d,g,b,j,c,f,i,h){$(document).on("launch.edition",function(m,l){console.log("external llamda del post",l);
m.stopImmediatePropagation();$(document).off("launch.edition");});$("#website_frame").load(function(){var l=$("#website_frame").contents().find("#external_links").hide();
});var a=function(){var l={language:beans.readCookie("language.initial")};k.menu=e.query({model:"content",query:JSON.stringify(l)},function(m){if(!m[0]){k.webmaster=true;
}else{k.webmaster=m[0].user_admin;}console.log(k.menu);});$(".content-details").fadeOut();};a();k.current_lang=beans.readCookie("language.initial");k.language=c.query({condition:"estado",attr:1},function(l){$("#language_panel_option").on("change",function(m){var n=$(this).val();
beans.createCookie("language.initial",n,10);a();});});$("#sortable_menu").sortable({items:"li:not(.enabled-sortable)",cursor:"move",handle:".text-success",start:function(l,m){startPosition=m.item.prevAll().length;
},update:function(n,o){endPosition=o.item.prevAll().length;var m={};$("#sortable_menu li.ui-state-default").each(function(p){m[p+1]=$(this).find("a").attr("id");
});var l=new j();l=$.extend(l,m);l.$save();}});k.save_post=function(m,n){$("#save_post").addClass("actived ui primary loading button");if(!m.idpost){var l=new d();
l.idcontent=n.idcontent;l=$.extend(l,m);l.$save(function(){k.block.post.push(l);$("#save_post").removeClass("actived ui primary loading button");beans.user_alert("post");
});}else{var l=new d({id:m.idpost});l=$.extend(l,m);l.$update(function(){$("#save_post").removeClass("actived ui primary loading button");beans.user_alert("post");
});}};k.save_content=function(o,n){$("#save_content").addClass("actived ui primary loading button");if(!o.idmenu){var m=new g();var l=new b();m=$.extend(m,o);
m.language=beans.readCookie("language.initial");l=$.extend(l,n);m.imagen=n.background;m.$save(function(p){l.idmenu=m.idmenu;l.$save(function(){var q={content:[],user_admin:k.webmaster};
m=$.extend(m,q);m.content[0]=l;k.menu.push(m);beans.user_alert("block");f.getAll();$("#save_content").removeClass("actived ui primary loading button");
});});}else{var m=new g({id:o.idmenu});var l=new b({id:n.idcontent});m=$.extend(m,o);l=$.extend(l,n);m.imagen=n.background;m.$update(function(){f.getAll();
});l.$update(function(){$("#save_content").removeClass("actived ui primary loading button");beans.user_alert("block");});}};k.remove_content=function(n){var m=new g({id:n.idmenu});
var l=new b({id:n.content[0].idcontent});m.$remove(function(){l.$remove();$(".content-details").fadeOut();for(var p=0,o=k.menu.length;p<o;p++){if(k.menu[p].idmenu===n.idmenu){k.menu.splice(p,1);
break;}}});};k.isActive=function(l){return l=="1"?true:false;};k.open_content=function(l){console.log(l);k.content=l;if(!l){k.content={user_admin:true,estado:0,minimal:0,template:"",background:""};
k.block=false;$("#save_form_content").find("#subheader").code("");}else{k.block=l.content[0];if(!k.block){k.block={subheader:""};}$("#save_form_content").find("#subheader").code(k.block.subheader);
}$(".content-details").fadeIn(function(){$("#main").animate({scrollTop:($(".content-details").offset().top+100)},1000);});};k.close_content=function(){$(".content-details").slideUp();
};k.remove_image=function(l){if(!l.image){l.background="";}else{l.image="";}};k.open_post=function(l){if(!l){var l={estado:0,image:""};$("#modal_post").find("#subheader").code("");
}else{$("#modal_post").find("#subheader").code(l.subheader);}k.post=l;$("#modal_post").modal_cw({closable:false,transition:"scale",selector:{close:".closing"}}).modal_cw("show");
};k.has_image=function(l){return l==""?false:true;};}]);cigarritaControllers.controller("languageCtrl",["$scope","Model","MultiLanguage",function(a,d,c){var b={get:"all"};
a.language=d.query({model:"language",id:"query",query:JSON.stringify(b)});a.isActive=function(e){return e=="1"?true:false;};a.show_modal=function(){a.lang=new Language();
$("#modal_language").modal_cw({closable:false,transition:"scale",selector:{close:".closing"}}).modal_cw("show");$("#flag_selector").dropdown();};a.save_lang=function(f){if(!f.idlanguage){$("#save_lang").addClass("actived ui primary loading button");
var e=new Language();e.estado=1;e.flag=$("#flag").val();e.min=$("#flag").val();e=$.extend(e,f);e.$save(function(){var g=new c({attr:e.flag});g.$save();
a.language.push(e);$("#save_lang").removeClass("actived ui primary loading button");beans.user_alert("lang.new");});}else{var e=new Language({condition:f.idlanguage});
if(f.estado==1){e.estado=0;f.estado=0;}else{e.estado=1;f.estado=1;}e.$update(function(){beans.user_alert("lang.update");});}};}]);cigarritaControllers.controller("messageCtrl",["$scope","Model",function(a,c){var b={get:"all"};
a.message=c.query({model:"form",id:"query",query:JSON.stringify(b)},function(d){setTimeout(function(){beans.generate_data_table("Listform");},200);});}]);
cigarritaControllers.controller("settingCtrl",["$scope","MyUser","Model",function(b,a,c){b.user=a.query(function(d){});c.query({model:"configuration"},function(d){b.web=d[0];
});b.save_user=function(d){$("#btn_save_user").addClass("actived ui primary loading button");if(d.new_password){d.password=d.new_password;}d.$update(function(){$("#btn_save_user").removeClass("actived ui primary loading button");
beans.user_alert("settings");});};b.save_web=function(d){$("#btn_save_web").addClass("actived ui primary loading button");d.$update({model:"configuration",id:d.idconfig},function(){$("#btn_save_web").removeClass("actived ui primary loading button");
beans.user_alert("settings");});};b.show_account=true;b.show_panel=function(d){if(d=="website"){b.show_account=false;b.show_website=true;}else{b.show_account=true;
b.show_website=false;}};}]);cigarritaControllers.controller("facebookCtrl",["$scope","Facebook","ApiFace","Json","Model",function(c,b,d,a,f){c.user={};
c.logged=false;c.byebye=false;c.salutation=false;a.query(function(g){console.log("Json:",g);});d.query({id:"1431968783721316"},function(g){console.log("ApiFace:",g);
});c.$watch(function(){return b.isReady();},function(g){if(g){c.facebookReady=true;}});var e=false;b.getLoginStatus(function(g){if(g.status=="connected"){e=true;
c.logged=true;b.api("/me",{accessToken:g.authResponse.accessToken},function(h){console.log(h);});}});c.IntentLogin=function(){if(!e){c.login();}};c.login=function(){b.login(function(g){if(g.status=="connected"){c.logged=true;
c.me();}},{scope:"public_profile,manage_pages"});};c.me=function(){b.api("/170064513039636?fields=cover,about,company_overview,mission,founded,emails,location,description,phone,category,posts.limit(5),events.limit(5).fields(cover,name,description,place).since(2014),photos.fields(picture,source),albums.limit(10).fields(name,photos.limit(10).fields(picture,source))",function(g){console.log(g);
c.$apply(function(){c.user=g;});});};c.logout=function(){b.logout(function(){c.$apply(function(){c.user={};c.logged=false;});});};c.$on("Facebook:statusChange",function(g,h){console.log("Status: ",h);
if(h.status=="connected"){c.$apply(function(){c.salutation=true;c.byebye=false;});}else{c.$apply(function(){c.salutation=false;c.byebye=true;});}});}]);
